name: Build and Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python: ["3.8", "3.8", "3.8", "3.8", "3.8", "3.9"]
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python }}
    - name: Install dependencies
      run: |
        pip install -U pip wheel setuptools codecov
        pip install -r reqs/requirements-latest.txt -r reqs/requirements-tests.txt
    - name: Run tests
      run: |
        coverage erase
        coverage run --branch bin/trial scrapyd
        coverage report
    - name: Upload coverage
      uses: codecov/codecov-action@v1
    - name: IRC Notification
      uses: actions/notify-irc@v1
      with:
        channels: "irc.freenode.org#scrapy"
        use_notice: true
        skip_join: true
